<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#FF9800">
    <link rel="manifest" href="manifest_preview.json">
    <title>üí∞ –ü–æ–ø–µ—Ä–µ–¥–Ω—ñ–π —Ä–æ–∑—Ä–∞—Ö—É–Ω–æ–∫</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #FF9800;
            --success: #4CAF50;
            --danger: #f44336;
            --warning: #FFC107;
            --border: #e0e0e0;
        }

        body {
            font-family: 'Manrope', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            background: white;
            padding: 25px;
            border-radius: 16px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }

        .header h1 {
            font-size: 2rem;
            color: var(--primary);
            margin-bottom: 8px;
        }

        .header p {
            color: #666;
            font-size: 0.95rem;
        }

        .card {
            background: white;
            padding: 25px;
            border-radius: 16px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.08);
            margin-bottom: 20px;
        }

        .card h2 {
            font-size: 1.3rem;
            color: #333;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
            font-size: 0.9rem;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid var(--border);
            border-radius: 10px;
            font-size: 1rem;
            font-family: inherit;
            transition: all 0.3s;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(255, 152, 0, 0.1);
        }

        .input-group {
            position: relative;
        }

        .input-suffix {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: #999;
            font-size: 0.9rem;
            pointer-events: none;
        }

        .grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .btn {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, var(--primary) 0%, #F57C00 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(255, 152, 0, 0.3);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 152, 0, 0.4);
        }

        .btn:active {
            transform: translateY(0);
        }

        .result-box {
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            color: white;
            padding: 20px;
            border-radius: 12px;
            margin-top: 20px;
        }

        .result-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid rgba(255,255,255,0.2);
        }

        .result-item:last-child {
            border-bottom: none;
        }

        .result-label {
            font-weight: 600;
        }

        .result-value {
            font-weight: 700;
            font-size: 1.1rem;
        }

        .total-box {
            background: rgba(255,255,255,0.2);
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
        }

        .total-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            font-size: 1.2rem;
        }

        .hint {
            display: block;
            margin-top: 5px;
            font-size: 0.8rem;
            color: #999;
        }

        .autocomplete {
            position: relative;
        }

        .autocomplete-items {
            position: absolute;
            border: 2px solid var(--border);
            border-top: none;
            border-radius: 0 0 8px 8px;
            z-index: 99;
            top: 100%;
            left: 0;
            right: 0;
            max-height: 250px;
            overflow-y: auto;
            background: white;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
        }

        .autocomplete-items div {
            padding: 12px;
            cursor: pointer;
            border-bottom: 1px solid var(--border);
            transition: background 0.2s;
        }

        .autocomplete-items div:hover {
            background-color: #f0f0f0;
        }

        .autocomplete-items div:last-child {
            border-bottom: none;
        }

        .route-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }

        .route-table td {
            padding: 10px;
            border-bottom: 1px solid var(--border);
            cursor: pointer;
            transition: background 0.2s;
        }

        .route-table tr:hover {
            background: #f5f5f5;
        }

        @media (max-width: 600px) {
            .grid-2 {
                grid-template-columns: 1fr;
            }

            body {
                padding: 10px;
            }

            .header h1 {
                font-size: 1.5rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üí∞ –ü–æ–ø–µ—Ä–µ–¥–Ω—ñ–π —Ä–æ–∑—Ä–∞—Ö—É–Ω–æ–∫</h1>
            <p>–û—Ü—ñ–Ω–∫–∞ –µ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è</p>
            <div style="margin-top: 10px; padding: 10px; background: #fff3e0; border-radius: 8px; font-size: 0.85rem; color: #e65100;">
                ‚ö†Ô∏è –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –¥–ª—è –æ—Ü—ñ–Ω–∫–∏ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è <strong>–ü–ï–†–ï–î</strong> –π–æ–≥–æ –ø—Ä–∏–π–Ω—è—Ç—Ç—è–º
            </div>
            <div style="margin-top: 10px;">
                <a href="waybill_calculator.html" style="display: inline-block; padding: 10px 20px; background: #0057B7; color: white; text-decoration: none; border-radius: 8px; font-weight: 600;">
                    üìã –ü–µ—Ä–µ–π—Ç–∏ –¥–æ –ø—É—Ç–∏–≤–Ω–æ–≥–æ –ª–∏—Å—Ç–∞
                </a>
            </div>
        </div>

        <div class="card">
            <h2>üë§ –í–æ–¥—ñ–π</h2>
            <div class="form-group">
                <label for="driver">–í–∏–±–µ—Ä—ñ—Ç—å –≤–æ–¥—ñ—è</label>
                <select id="driver">
                    <option value="">-- –í–∏–±–µ—Ä—ñ—Ç—å –≤–æ–¥—ñ—è --</option>
                    <option value="–°—Ç–∞—Ä–æ–¥—É–± –°–µ—Ä–≥—ñ–π –û–ª–µ–∫—Å–∞–Ω–¥—Ä–æ–≤–∏—á">–°—Ç–∞—Ä–æ–¥—É–± –°–µ—Ä–≥—ñ–π –û–ª–µ–∫—Å–∞–Ω–¥—Ä–æ–≤–∏—á</option>
                    <option value="–ù–∞—Ä–∏–≤–æ–Ω—á–∏–∫ –û–ª–µ–∫—Å–∞–Ω–¥—Ä –í–∞—Å–∏–ª—å–æ–≤–∏—á">–ù–∞—Ä–∏–≤–æ–Ω—á–∏–∫ –û–ª–µ–∫—Å–∞–Ω–¥—Ä –í–∞—Å–∏–ª—å–æ–≤–∏—á</option>
                    <option value="–î–∏–º–æ–≥–ª–æ–≤ –ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤–∏—á">–î–∏–º–æ–≥–ª–æ–≤ –ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤–∏—á</option>
                    <option value="–¢—É—Ä–∫—ñ–≤ –°—Ç–µ–ø–∞–Ω –î–º–∏—Ç—Ä–æ–≤–∏—á">–¢—É—Ä–∫—ñ–≤ –°—Ç–µ–ø–∞–Ω –î–º–∏—Ç—Ä–æ–≤–∏—á</option>
                    <option value="–î–µ–º—á–µ–Ω–∫–æ –û–ª–µ–∫—Å–µ–π –ë–æ—Ä–∏—Å–æ–≤–∏—á">–î–µ–º—á–µ–Ω–∫–æ –û–ª–µ–∫—Å–µ–π –ë–æ—Ä–∏—Å–æ–≤–∏—á</option>
                    <option value="–ö—É–∑–Ω–µ—Ü–æ–≤ –°–µ—Ä–≥—ñ–π –í–æ–ª–æ–¥–∏–º–∏—Ä–æ–≤–∏—á">–ö—É–∑–Ω–µ—Ü–æ–≤ –°–µ—Ä–≥—ñ–π –í–æ–ª–æ–¥–∏–º–∏—Ä–æ–≤–∏—á</option>
                    <option value="–§–µ—Å–µ—á–∫–æ –û–ª–µ–∫—Å–∞–Ω–¥—Ä –ú–∏–∫–æ–ª–∞–π–æ–≤–∏—á">–§–µ—Å–µ—á–∫–æ –û–ª–µ–∫—Å–∞–Ω–¥—Ä –ú–∏–∫–æ–ª–∞–π–æ–≤–∏—á</option>
                    <option value="–ö–æ–≤–∞–ª—å—á—É–∫ –û–ª–µ–≥ –ü–µ—Ç—Ä–æ–≤–∏—á">–ö–æ–≤–∞–ª—å—á—É–∫ –û–ª–µ–≥ –ü–µ—Ç—Ä–æ–≤–∏—á</option>
                    <option value="–í–∞—Ä–µ–Ω—á—É–∫ –°–µ—Ä–≥—ñ–π –ê–Ω–∞—Ç–æ–ª—ñ–π–æ–≤–∏—á">–í–∞—Ä–µ–Ω—á—É–∫ –°–µ—Ä–≥—ñ–π –ê–Ω–∞—Ç–æ–ª—ñ–π–æ–≤–∏—á</option>
                    <option value="–§–∞—ó–Ω –ê–Ω–¥—Ä—ñ–π –ê–ª—å–±–µ—Ä—Ç–æ–≤–∏—á">–§–∞—ó–Ω –ê–Ω–¥—Ä—ñ–π –ê–ª—å–±–µ—Ä—Ç–æ–≤–∏—á</option>
                    <option value="–Ñ–∂–¥—ñ–Ω –û–ª–µ–∫—Å–∞–Ω–¥—Ä">–Ñ–∂–¥—ñ–Ω –û–ª–µ–∫—Å–∞–Ω–¥—Ä</option>
                    <option value="–ö–∏—Ä–∏–ª–æ–≤ –†–æ—Å—Ç–∏—Å–ª–∞–≤ –ú–∏—Ö–∞–π–ª–æ–≤–∏—á">–ö–∏—Ä–∏–ª–æ–≤ –†–æ—Å—Ç–∏—Å–ª–∞–≤ –ú–∏—Ö–∞–π–ª–æ–≤–∏—á</option>
                </select>
                <small class="hint">üí° –ù–µ–æ–±–æ–≤'—è–∑–∫–æ–≤–æ, –¥–ª—è –¥–æ–≤—ñ–¥–∫–∏</small>
            </div>
        </div>

        <div class="card">
            <h2>üìç –ú–∞—Ä—à—Ä—É—Ç</h2>
            
            <div class="form-group">
                <label for="fromCity">üö© –ó–≤—ñ–¥–∫–∏ (–º—ñ—Å—Ç–æ)</label>
                <div class="autocomplete">
                    <input type="text" id="fromCity" placeholder="–ü–æ—á–Ω—ñ—Ç—å –≤–≤–æ–¥–∏—Ç–∏ –Ω–∞–∑–≤—É –º—ñ—Å—Ç–∞..." autocomplete="off">
                    <div id="fromCityAutocomplete" class="autocomplete-items"></div>
                </div>
            </div>

            <div class="form-group">
                <label for="toCity">üèÅ –ö—É–¥–∏ (–º—ñ—Å—Ç–æ)</label>
                <div class="autocomplete">
                    <input type="text" id="toCity" placeholder="–ü–æ—á–Ω—ñ—Ç—å –≤–≤–æ–¥–∏—Ç–∏ –Ω–∞–∑–≤—É –º—ñ—Å—Ç–∞..." autocomplete="off">
                    <div id="toCityAutocomplete" class="autocomplete-items"></div>
                </div>
            </div>

            <button class="btn" onclick="calculateRoute()" style="background: linear-gradient(135deg, #2196F3 0%, #1976D2 100%); margin-bottom: 15px;">
                üîç –†–æ–∑—Ä–∞—Ö—É–≤–∞—Ç–∏ –≤—ñ–¥—Å—Ç–∞–Ω—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ
            </button>

            <div id="routeInfo" style="display: none; background: #e3f2fd; padding: 15px; border-radius: 10px; margin-bottom: 15px;">
                <div style="font-weight: 600; color: #1976D2; margin-bottom: 8px;">‚úÖ –ú–∞—Ä—à—Ä—É—Ç –∑–Ω–∞–π–¥–µ–Ω–æ:</div>
                <div id="routeData"></div>
            </div>

            <!-- Popular routes table -->
            <details style="margin-bottom: 15px;">
                <summary style="cursor: pointer; font-weight: 600; color: var(--primary); padding: 10px; background: #fff3e0; border-radius: 8px;">
                    üìã –î–æ–≤—ñ–¥–Ω–∏–∫ –º–∞—Ä—à—Ä—É—Ç—ñ–≤ (–∫–ª–∞—Ü–Ω—ñ—Ç—å –¥–ª—è –≤–∏–±–æ—Ä—É)
                </summary>
                <table class="route-table" id="routesTable">
                    <tbody>
                        <!-- Routes will be populated by JavaScript -->
                    </tbody>
                </table>
                <div style="margin-top: 15px; padding: 15px; background: #e3f2fd; border-radius: 8px;">
                    <div style="font-weight: 600; margin-bottom: 10px;">‚ûï –î–æ–¥–∞—Ç–∏ –º–∞—Ä—à—Ä—É—Ç —É –¥–æ–≤—ñ–¥–Ω–∏–∫</div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr 0.7fr auto; gap: 8px;">
                        <input type="text" id="newFrom" placeholder="–ó–≤—ñ–¥–∫–∏" style="padding: 8px; border-radius: 6px; border: 1px solid #ddd;">
                        <input type="text" id="newTo" placeholder="–ö—É–¥–∏" style="padding: 8px; border-radius: 6px; border: 1px solid #ddd;">
                        <input type="number" id="newDist" placeholder="–∫–º" style="padding: 8px; border-radius: 6px; border: 1px solid #ddd;">
                        <button onclick="addRoute()" style="padding: 8px 15px; background: var(--primary); color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 600;">‚ûï</button>
                    </div>
                </div>
            </details>

            <div class="form-group">
                <label for="distance">–í—ñ–¥—Å—Ç–∞–Ω—å –º–∞—Ä—à—Ä—É—Ç—É</label>
                <div class="input-group">
                    <input type="number" id="distance" value="540" min="0">
                    <span class="input-suffix">–∫–º</span>
                </div>
                <small class="hint">üí° –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∞–±–æ –≤–≤–µ–¥—ñ—Ç—å –≤—Ä—É—á–Ω—É</small>
            </div>
        </div>

        <div class="card">
            <h2>üí∞ –í–∞—Ä—Ç—ñ—Å—Ç—å —ñ –≤–∏—Ç—Ä–∞—Ç–∏</h2>
            
            <div class="form-group">
                <label for="orderCost">–í–∞—Ä—Ç—ñ—Å—Ç—å –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è (–≤—ñ–¥ –∫–ª—ñ—î–Ω—Ç–∞)</label>
                <div class="input-group">
                    <input type="number" id="orderCost" value="30000" min="0">
                    <span class="input-suffix">–≥—Ä–Ω</span>
                </div>
            </div>

            <div class="grid-2">
                <div class="form-group">
                    <label for="salary">–ó–∞—Ä–ø–ª–∞—Ç–∞ –≤–æ–¥—ñ—è</label>
                    <div class="input-group">
                        <input type="number" id="salary" value="4500" readonly style="background: #f0f0f0;">
                        <span class="input-suffix">–≥—Ä–Ω</span>
                    </div>
                    <small class="hint">üí° –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ: 15% –≤—ñ–¥ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è</small>
                </div>

                <div class="form-group">
                    <label for="perDiem">–î–æ–±–æ–≤—ñ</label>
                    <div class="input-group">
                        <input type="number" id="perDiem" value="600">
                        <span class="input-suffix">–≥—Ä–Ω/–¥–µ–Ω—å</span>
                    </div>
                </div>
            </div>

            <div class="grid-2">
                <div class="form-group">
                    <label for="days">–î–Ω—ñ–≤ —É —Ä–µ–π—Å—ñ</label>
                    <div class="input-group">
                        <input type="number" id="days" value="2" min="1">
                        <span class="input-suffix">–¥–Ω—ñ–≤</span>
                    </div>
                </div>

                <div class="form-group">
                    <label for="fuelConsumption">–í–∏—Ç—Ä–∞—Ç–∞ –ø–∞–ª–∏–≤–∞</label>
                    <div class="input-group">
                        <input type="number" id="fuelConsumption" value="25" step="0.1">
                        <span class="input-suffix">–ª/100–∫–º</span>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label for="fuelPrice">–¶—ñ–Ω–∞ –ø–∞–ª–∏–≤–∞</label>
                <div class="input-group">
                    <input type="number" id="fuelPrice" value="55">
                    <span class="input-suffix">–≥—Ä–Ω/–ª</span>
                </div>
            </div>

            <div class="form-group">
                <label for="otherCosts">–Ü–Ω—à—ñ –≤–∏—Ç—Ä–∞—Ç–∏</label>
                <div class="input-group">
                    <input type="number" id="otherCosts" value="0">
                    <span class="input-suffix">–≥—Ä–Ω</span>
                </div>
                <small class="hint">üí° –î–æ—Ä–æ–∂–Ω—ñ –∑–±–æ—Ä–∏, –ø–∞—Ä–∫—É–≤–∞–Ω–Ω—è, —Ç–æ—â–æ</small>
            </div>
        </div>

        <button class="btn" onclick="calculate()">–†–æ–∑—Ä–∞—Ö—É–≤–∞—Ç–∏ –µ—Ñ–µ–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å</button>

        <div id="results" style="display: none;">
            <div class="card">
                <h2>üìä –†–µ–∑—É–ª—å—Ç–∞—Ç–∏ —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫—É</h2>
                
                <div class="result-item">
                    <span class="result-label">–í—ñ–¥—Å—Ç–∞–Ω—å:</span>
                    <span class="result-value" id="resDistance">0 –∫–º</span>
                </div>
                <div class="result-item">
                    <span class="result-label">–ü–∞–ª–∏–≤–æ:</span>
                    <span class="result-value" id="resFuel">0 –ª</span>
                </div>
                <div class="result-item">
                    <span class="result-label">–í–∞—Ä—Ç—ñ—Å—Ç—å –ø–∞–ª–∏–≤–∞:</span>
                    <span class="result-value" id="resFuelCost">0 –≥—Ä–Ω</span>
                </div>
                <div class="result-item">
                    <span class="result-label">–ó–∞—Ä–ø–ª–∞—Ç–∞:</span>
                    <span class="result-value" id="resSalary">0 –≥—Ä–Ω</span>
                </div>
                <div class="result-item">
                    <span class="result-label">–î–æ–±–æ–≤—ñ:</span>
                    <span class="result-value" id="resPerDiem">0 –≥—Ä–Ω</span>
                </div>
                <div class="result-item">
                    <span class="result-label">–Ü–Ω—à—ñ –≤–∏—Ç—Ä–∞—Ç–∏:</span>
                    <span class="result-value" id="resOther">0 –≥—Ä–Ω</span>
                </div>
            </div>

            <div class="result-box" id="profitBox">
                <div class="total-box">
                    <div class="total-item">
                        <span>–î–æ—Ö—ñ–¥:</span>
                        <span id="resIncome">0 –≥—Ä–Ω</span>
                    </div>
                    <div class="total-item">
                        <span>–í–∏—Ç—Ä–∞—Ç–∏:</span>
                        <span id="resCosts">0 –≥—Ä–Ω</span>
                    </div>
                    <div class="total-item" style="border-top: 2px solid rgba(255,255,255,0.3); padding-top: 15px; margin-top: 10px; font-size: 1.4rem;">
                        <span>–ü–†–ò–ë–£–¢–û–ö:</span>
                        <span id="resProfit">0 –≥—Ä–Ω</span>
                    </div>
                    <div class="total-item" style="font-size: 1.2rem;">
                        <span>–†–µ–Ω—Ç–∞–±–µ–ª—å–Ω—ñ—Å—Ç—å:</span>
                        <span id="resMargin">0%</span>
                    </div>
                </div>

                <div id="recommendation" style="margin-top: 15px; padding: 15px; background: rgba(255,255,255,0.2); border-radius: 8px; font-size: 1.1rem; font-weight: 600; text-align: center;">
                </div>
            </div>
        </div>
    </div>

    <script>
        // Routes database
        let routes = [
            ["–ö–∏—ó–≤", "–í—ñ–Ω–Ω–∏—Ü—è", 267], ["–ö–∏—ó–≤", "–î–Ω—ñ–ø—Ä–æ", 480], ["–ö–∏—ó–≤", "–ñ–∏—Ç–æ–º–∏—Ä", 140],
            ["–ö–∏—ó–≤", "–ó–∞–ø–æ—Ä—ñ–∂–∂—è", 520], ["–ö–∏—ó–≤", "–Ü–≤–∞–Ω–æ-–§—Ä–∞–Ω–∫—ñ–≤—Å—å–∫", 590], ["–ö–∏—ó–≤", "–ö—Ä–æ–ø–∏–≤–Ω–∏—Ü—å–∫–∏–π", 310],
            ["–ö–∏—ó–≤", "–õ—É—Ü—å–∫", 410], ["–ö–∏—ó–≤", "–õ—å–≤—ñ–≤", 540], ["–ö–∏—ó–≤", "–ú–∏–∫–æ–ª–∞—ó–≤", 490],
            ["–ö–∏—ó–≤", "–û–¥–µ—Å–∞", 475], ["–ö–∏—ó–≤", "–ü–æ–ª—Ç–∞–≤–∞", 340], ["–ö–∏—ó–≤", "–†—ñ–≤–Ω–µ", 315],
            ["–ö–∏—ó–≤", "–°—É–º–∏", 350], ["–ö–∏—ó–≤", "–¢–µ—Ä–Ω–æ–ø—ñ–ª—å", 440], ["–ö–∏—ó–≤", "–•–∞—Ä–∫—ñ–≤", 480],
            ["–ö–∏—ó–≤", "–•–µ—Ä—Å–æ–Ω", 600], ["–ö–∏—ó–≤", "–•–º–µ–ª—å–Ω–∏—Ü—å–∫–∏–π", 380], ["–ö–∏—ó–≤", "–ß–µ—Ä–∫–∞—Å–∏", 195],
            ["–ö–∏—ó–≤", "–ß–µ—Ä–Ω—ñ–≤—Ü—ñ", 470], ["–ö–∏—ó–≤", "–ß–µ—Ä–Ω—ñ–≥—ñ–≤", 145],
            ["–õ—å–≤—ñ–≤", "–û–¥–µ—Å–∞", 790], ["–õ—å–≤—ñ–≤", "–•–∞—Ä–∫—ñ–≤", 1020], ["–õ—å–≤—ñ–≤", "–î–Ω—ñ–ø—Ä–æ", 820],
            ["–û–¥–µ—Å–∞", "–•–∞—Ä–∫—ñ–≤", 730], ["–û–¥–µ—Å–∞", "–î–Ω—ñ–ø—Ä–æ", 450],
            ["–•–∞—Ä–∫—ñ–≤", "–î–Ω—ñ–ø—Ä–æ", 215], ["–•–∞—Ä–∫—ñ–≤", "–ó–∞–ø–æ—Ä—ñ–∂–∂—è", 280], ["–î–Ω—ñ–ø—Ä–æ", "–ó–∞–ø–æ—Ä—ñ–∂–∂—è", 85]
        ];

        // Load custom routes from localStorage
        const savedRoutes = localStorage.getItem('customRoutes');
        if (savedRoutes) {
            try {
                const custom = JSON.parse(savedRoutes);
                routes = [...routes, ...custom];
            } catch (e) {
                console.error('Error loading routes:', e);
            }
        }

        // Populate routes table
        function populateRoutes() {
            const tbody = document.getElementById('routesTable').querySelector('tbody');
            tbody.innerHTML = '';
            routes.forEach(([from, to, dist]) => {
                const tr = document.createElement('tr');
                tr.onclick = () => selectRoute(from, to, dist);
                tr.innerHTML = `
                    <td style="font-weight: 600;">${from} ‚Üí ${to}</td>
                    <td style="text-align: right; color: var(--primary); font-weight: 700;">${dist} –∫–º</td>
                `;
                tbody.appendChild(tr);
            });
        }

        populateRoutes();

        // Select route
        function selectRoute(from, to, dist) {
            document.getElementById('fromCity').value = from;
            document.getElementById('toCity').value = to;
            document.getElementById('distance').value = dist;
            
            document.getElementById('routeInfo').style.display = 'block';
            document.getElementById('routeData').innerHTML = `
                <div style="display: flex; justify-content: space-between; padding: 5px 0;">
                    <span>–ú–∞—Ä—à—Ä—É—Ç:</span>
                    <strong>${from} ‚Üí ${to}</strong>
                </div>
                <div style="display: flex; justify-content: space-between; padding: 5px 0;">
                    <span>–í—ñ–¥—Å—Ç–∞–Ω—å:</span>
                    <strong>${dist} –∫–º</strong>
                </div>
            `;
        }

        // Add new route
        function addRoute() {
            const from = document.getElementById('newFrom').value.trim();
            const to = document.getElementById('newTo').value.trim();
            const dist = parseInt(document.getElementById('newDist').value);

            if (!from || !to || !dist) {
                alert('–ó–∞–ø–æ–≤–Ω—ñ—Ç—å –≤—Å—ñ –ø–æ–ª—è!');
                return;
            }

            routes.push([from, to, dist]);
            
            // Save to localStorage
            const customRoutes = routes.slice(28); // Save only custom routes
            localStorage.setItem('customRoutes', JSON.stringify(customRoutes));
            
            populateRoutes();
            
            document.getElementById('newFrom').value = '';
            document.getElementById('newTo').value = '';
            document.getElementById('newDist').value = '';
            
            alert(`‚úÖ –ú–∞—Ä—à—Ä—É—Ç "${from} ‚Üí ${to}" –¥–æ–¥–∞–Ω–æ!`);
        }

        // Calculate route distance using OSRM
        async function calculateRoute() {
            const from = document.getElementById('fromCity').value.trim();
            const to = document.getElementById('toCity').value.trim();

            if (!from || !to) {
                return; // Silent return for auto-trigger
            }

            // Check if called from button (has event) or auto-triggered
            const hasButton = typeof event !== 'undefined' && event && event.target;
            let btn, originalText;
            
            if (hasButton) {
                btn = event.target;
                originalText = btn.textContent;
                btn.textContent = '‚è≥ –†–æ–∑—Ä–∞—Ö—É–Ω–æ–∫...';
                btn.disabled = true;
            }

            try {
                // First, check if route exists in local database (instant)
                const localRoute = routes.find(r => 
                    (r[0] === from && r[1] === to) || 
                    (r[0] === to && r[1] === from)
                );
                
                if (localRoute) {
                    // Use local route
                    const distance = localRoute[2];
                    document.getElementById('distance').value = distance;
                    
                    document.getElementById('routeInfo').style.display = 'block';
                    document.getElementById('routeData').innerHTML = `
                        <div style="display: flex; justify-content: space-between; padding: 5px 0;">
                            <span>–ú–∞—Ä—à—Ä—É—Ç:</span>
                            <strong>${from} ‚Üí ${to}</strong>
                        </div>
                        <div style="display: flex; justify-content: space-between; padding: 5px 0;">
                            <span>–í—ñ–¥—Å—Ç–∞–Ω—å:</span>
                            <strong style="color: #4CAF50; font-size: 1.2rem;">${distance} –∫–º</strong>
                        </div>
                        <div style="margin-top: 10px; padding: 8px; background: #e8f5e9; border-radius: 6px; font-size: 0.85rem; color: #2e7d32;">
                            ‚úÖ –ó–Ω–∞–π–¥–µ–Ω–æ –≤ –¥–æ–≤—ñ–¥–Ω–∏–∫—É –º–∞—Ä—à—Ä—É—Ç—ñ–≤ (–º–∏—Ç—Ç—î–≤–æ)
                        </div>
                    `;
                    
                    if (hasButton) {
                        btn.textContent = originalText;
                        btn.disabled = false;
                    }
                    return;
                }

                // If not in database, use OSRM
                console.log('Geocoding:', from, '‚Üí', to);
                
                const fromCoords = await geocodeCity(from);
                const toCoords = await geocodeCity(to);
                
                console.log('Coordinates:', fromCoords, '‚Üí', toCoords);

                // Step 2: Calculate route using OSRM
                const routeUrl = `https://router.project-osrm.org/route/v1/driving/${fromCoords.lon},${fromCoords.lat};${toCoords.lon},${toCoords.lat}?overview=false`;
                
                const routeResponse = await fetch(routeUrl);
                const routeData = await routeResponse.json();

                if (routeData.code !== 'Ok' || !routeData.routes || !routeData.routes[0]) {
                    throw new Error('–ú–∞—Ä—à—Ä—É—Ç –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ');
                }

                const route = routeData.routes[0];
                const distance = Math.round(route.distance / 1000); // meters to km
                const duration = Math.round(route.duration / 3600); // seconds to hours

                // Update fields
                document.getElementById('distance').value = distance;

                // Show result
                document.getElementById('routeInfo').style.display = 'block';
                document.getElementById('routeData').innerHTML = `
                    <div style="display: flex; justify-content: space-between; padding: 5px 0;">
                        <span>–ú–∞—Ä—à—Ä—É—Ç:</span>
                        <strong>${from} ‚Üí ${to}</strong>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 5px 0;">
                        <span>–í—ñ–¥—Å—Ç–∞–Ω—å:</span>
                        <strong style="color: var(--primary);">${distance} –∫–º</strong>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 5px 0;">
                        <span>–û—Ä—ñ—î–Ω—Ç–æ–≤–Ω–∏–π —á–∞—Å:</span>
                        <strong>${duration} –≥–æ–¥</strong>
                    </div>
                    <div style="margin-top: 10px; padding: 10px; background: rgba(76, 175, 80, 0.1); border-radius: 6px; font-size: 0.85rem; color: #2e7d32;">
                        ‚úÖ –ú–∞—Ä—à—Ä—É—Ç —Ä–æ–∑—Ä–∞—Ö–æ–≤–∞–Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ —á–µ—Ä–µ–∑ OSRM
                    </div>
                `;

                console.log('Route calculated:', distance, 'km,', duration, 'hours');

            } catch (error) {
                console.error('Route calculation error:', error);
                
                // Show user-friendly message
                document.getElementById('routeInfo').style.display = 'block';
                document.getElementById('routeData').innerHTML = `
                    <div style="padding: 15px; background: #fff3e0; border-radius: 8px; border-left: 4px solid #ff9800;">
                        <div style="font-weight: 600; margin-bottom: 8px; color: #e65100;">
                            ‚ö†Ô∏è –ù–µ –≤–¥–∞–ª–æ—Å—è —Ä–æ–∑—Ä–∞—Ö—É–≤–∞—Ç–∏ —á–µ—Ä–µ–∑ OSRM
                        </div>
                        <div style="font-size: 0.9rem; color: #666; margin-bottom: 12px;">
                            ${error.message === 'Failed to fetch' 
                                ? '–°–µ—Ä–≤—ñ—Å OSRM —Ç–∏–º—á–∞—Å–æ–≤–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∏–π –∞–±–æ –∑–∞–±–ª–æ–∫–æ–≤–∞–Ω–∏–π –º–µ—Ä–µ–∂–µ—é.'
                                : error.message
                            }
                        </div>
                        <div style="background: white; padding: 12px; border-radius: 6px; margin-top: 10px;">
                            <div style="font-weight: 600; color: var(--primary); margin-bottom: 8px;">
                                üí° –í–∏–∫–æ—Ä–∏—Å—Ç–∞–π—Ç–µ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∏:
                            </div>
                            <div style="font-size: 0.85rem; line-height: 1.6;">
                                üìã <strong>–î–æ–≤—ñ–¥–Ω–∏–∫ –º–∞—Ä—à—Ä—É—Ç—ñ–≤</strong> (–Ω–∏–∂—á–µ)<br>
                                &nbsp;&nbsp;&nbsp;&nbsp;‚Üí 29 –≥–æ—Ç–æ–≤–∏—Ö –º–∞—Ä—à—Ä—É—Ç—ñ–≤, –ø—Ä–∞—Ü—é—î –º–∏—Ç—Ç—î–≤–æ<br><br>
                                ‚ûï <strong>–î–æ–¥–∞–π—Ç–µ —Å–≤—ñ–π –º–∞—Ä—à—Ä—É—Ç</strong><br>
                                &nbsp;&nbsp;&nbsp;&nbsp;‚Üí –ó–Ω–∞–π–¥—ñ—Ç—å –≤—ñ–¥—Å—Ç–∞–Ω—å –≤ Google Maps<br>
                                &nbsp;&nbsp;&nbsp;&nbsp;‚Üí –î–æ–¥–∞–π—Ç–µ –≤ –¥–æ–≤—ñ–¥–Ω–∏–∫ (–∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è –Ω–∞–∑–∞–≤–∂–¥–∏)<br><br>
                                ‚úèÔ∏è <strong>–í–≤–µ–¥—ñ—Ç—å –≤—Ä—É—á–Ω—É</strong><br>
                                &nbsp;&nbsp;&nbsp;&nbsp;‚Üí –ü—Ä–æ—Å—Ç–æ –≤–∫–∞–∂—ñ—Ç—å –≤—ñ–¥—Å—Ç–∞–Ω—å –≤ –∫–º
                            </div>
                        </div>
                    </div>
                `;
                
                if (hasButton) {
                    // Only show alert for manual button clicks
                    setTimeout(() => {
                        alert('‚ö†Ô∏è OSRM —Ç–∏–º—á–∞—Å–æ–≤–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∏–π.\n\n‚úÖ –í–∏–∫–æ—Ä–∏—Å—Ç–∞–π—Ç–µ –¥–æ–≤—ñ–¥–Ω–∏–∫ –º–∞—Ä—à—Ä—É—Ç—ñ–≤ (–Ω–∏–∂—á–µ)\n–∞–±–æ –≤–≤–µ–¥—ñ—Ç—å –≤—ñ–¥—Å—Ç–∞–Ω—å –≤—Ä—É—á–Ω—É.');
                    }, 100);
                }
            } finally {
                if (hasButton) {
                    btn.textContent = originalText;
                    btn.disabled = false;
                }
            }
        }

        // Geocode city to coordinates
        async function geocodeCity(cityName) {
            const url = `https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(cityName)}&countrycodes=ua,md,ro,bg,tr&limit=1&addressdetails=1`;
            
            try {
                const response = await fetch(url, {
                    headers: {
                        'Accept-Language': 'uk,ru,en,ro,bg,tr',
                        'User-Agent': 'TransportCalculator/1.0'
                    }
                });

                if (!response.ok) {
                    throw new Error('–ü–æ–º–∏–ª–∫–∞ –≥–µ–æ–∫–æ–¥—É–≤–∞–Ω–Ω—è');
                }

                const data = await response.json();

                if (!data || data.length === 0) {
                    throw new Error(`–ú—ñ—Å—Ç–æ "${cityName}" –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ`);
                }

                return {
                    lat: parseFloat(data[0].lat),
                    lon: parseFloat(data[0].lon),
                    displayName: data[0].display_name
                };
            } catch (error) {
                // If fetch fails, try to estimate from known cities
                const knownCoordinates = {
                    '–ö–∏—ó–≤': { lat: 50.4501, lon: 30.5234 },
                    '–õ—å–≤—ñ–≤': { lat: 49.8397, lon: 24.0297 },
                    '–û–¥–µ—Å–∞': { lat: 46.4825, lon: 30.7233 },
                    '–•–∞—Ä–∫—ñ–≤': { lat: 49.9935, lon: 36.2304 },
                    '–î–Ω—ñ–ø—Ä–æ': { lat: 48.4647, lon: 35.0462 },
                    '–•–º–µ–ª—å–Ω–∏—Ü—å–∫–∏–π': { lat: 49.4229, lon: 26.9871 },
                    '–ß–µ—Ä–Ω—ñ–≤—Ü—ñ': { lat: 48.2921, lon: 25.9358 },
                    '–°—É–º–∏': { lat: 50.9077, lon: 34.7981 }
                };
                
                if (knownCoordinates[cityName]) {
                    return knownCoordinates[cityName];
                }
                
                throw error;
            }
        }

        // Auto-calculate salary (15%)
        document.getElementById('orderCost').addEventListener('input', function() {
            const orderCost = parseFloat(this.value) || 0;
            document.getElementById('salary').value = Math.round(orderCost * 0.15);
        });

        // City autocomplete
        const ukrainianCities = [
            '–ö–∏—ó–≤', '–õ—å–≤—ñ–≤', '–û–¥–µ—Å–∞', '–î–Ω—ñ–ø—Ä–æ', '–•–∞—Ä–∫—ñ–≤', '–ó–∞–ø–æ—Ä—ñ–∂–∂—è', '–í—ñ–Ω–Ω–∏—Ü—è', '–ñ–∏—Ç–æ–º–∏—Ä',
            '–Ü–≤–∞–Ω–æ-–§—Ä–∞–Ω–∫—ñ–≤—Å—å–∫', '–ö—Ä–æ–ø–∏–≤–Ω–∏—Ü—å–∫–∏–π', '–õ—É—Ü—å–∫', '–ú–∏–∫–æ–ª–∞—ó–≤', '–ü–æ–ª—Ç–∞–≤–∞', '–†—ñ–≤–Ω–µ',
            '–°—É–º–∏', '–¢–µ—Ä–Ω–æ–ø—ñ–ª—å', '–•–µ—Ä—Å–æ–Ω', '–•–º–µ–ª—å–Ω–∏—Ü—å–∫–∏–π', '–ß–µ—Ä–∫–∞—Å–∏', '–ß–µ—Ä–Ω—ñ–≤—Ü—ñ', '–ß–µ—Ä–Ω—ñ–≥—ñ–≤',
            '–ú–∞—Ä—ñ—É–ø–æ–ª—å', '–ö—Ä–∏–≤–∏–π –†—ñ–≥', '–ö—Ä–µ–º–µ–Ω—á—É–∫', '–£–∂–≥–æ—Ä–æ–¥', '–ë–µ—Ä–¥—è–Ω—Å—å–∫', '–ú–µ–ª—ñ—Ç–æ–ø–æ–ª—å',
            '–ë—ñ–ª–∞ –¶–µ—Ä–∫–≤–∞', '–ë—Ä–æ–≤–∞—Ä–∏', '–ß–æ—Ä–Ω–æ–º–æ—Ä—Å—å–∫', '–ë–æ—Ä–∏—Å–ø—ñ–ª—å', '–ë–∞—Ö–º—É—Ç', '–ö—Ä–∞–º–∞—Ç–æ—Ä—Å—å–∫',
            '–°–ª–æ–≤\'—è–Ω—Å—å–∫', '–°—î–≤—î—Ä–æ–¥–æ–Ω–µ—Ü—å–∫', '–ü–∞–≤–ª–æ–≥—Ä–∞–¥', '–°—Ç—Ä–∏–π', '–ö–æ–ª–æ–º–∏—è', '–î—Ä–æ–≥–æ–±–∏—á',
            '–ö–∏—à–∏–Ω—ñ–≤', '–ë—É—Ö–∞—Ä–µ—Å—Ç', '–°–æ—Ñ—ñ—è', '–°—Ç–∞–º–±—É–ª', '–ê–Ω–∫–∞—Ä–∞', '–ö–æ–Ω—Å—Ç–∞–Ω—Ü–∞', '–í–∞—Ä–Ω–∞'
        ];

        function setupCityAutocomplete(inputId, autocompleteId) {
            const input = document.getElementById(inputId);
            const autocompleteDiv = document.getElementById(autocompleteId);

            input.addEventListener('input', function() {
                const value = this.value.toLowerCase();
                autocompleteDiv.innerHTML = '';

                if (!value) {
                    return;
                }

                const matches = ukrainianCities.filter(city => 
                    city.toLowerCase().includes(value)
                ).slice(0, 8);

                matches.forEach(city => {
                    const item = document.createElement('div');
                    
                    // Highlight matching part
                    const index = city.toLowerCase().indexOf(value);
                    const before = city.substring(0, index);
                    const match = city.substring(index, index + value.length);
                    const after = city.substring(index + value.length);
                    
                    item.innerHTML = `${before}<strong style="color: var(--primary);">${match}</strong>${after}`;
                    
                    item.addEventListener('click', function() {
                        input.value = city;
                        autocompleteDiv.innerHTML = '';
                        
                        // Auto-calculate route when both cities are filled
                        autoCalculateIfReady();
                    });
                    
                    autocompleteDiv.appendChild(item);
                });
            });

            // Close on click outside
            document.addEventListener('click', function(e) {
                if (e.target !== input) {
                    autocompleteDiv.innerHTML = '';
                }
            });
        }

        // Auto-calculate route when both cities are selected
        function autoCalculateIfReady() {
            const from = document.getElementById('fromCity').value.trim();
            const to = document.getElementById('toCity').value.trim();
            
            if (from && to && from.length > 2 && to.length > 2) {
                // Small delay to ensure UI updates
                setTimeout(() => {
                    calculateRoute();
                }, 300);
            }
        }

        setupCityAutocomplete('fromCity', 'fromCityAutocomplete');
        setupCityAutocomplete('toCity', 'toCityAutocomplete');

        // Calculate
        function calculate() {
            const distance = parseFloat(document.getElementById('distance').value) || 0;
            const orderCost = parseFloat(document.getElementById('orderCost').value) || 0;
            const salary = parseFloat(document.getElementById('salary').value) || 0;
            const perDiem = parseFloat(document.getElementById('perDiem').value) || 0;
            const days = parseFloat(document.getElementById('days').value) || 0;
            const fuelConsumption = parseFloat(document.getElementById('fuelConsumption').value) || 0;
            const fuelPrice = parseFloat(document.getElementById('fuelPrice').value) || 0;
            const otherCosts = parseFloat(document.getElementById('otherCosts').value) || 0;

            if (distance === 0) {
                alert('–í–≤–µ–¥—ñ—Ç—å –≤—ñ–¥—Å—Ç–∞–Ω—å –º–∞—Ä—à—Ä—É—Ç—É!');
                return;
            }

            // Calculate
            const fuel = (distance * fuelConsumption) / 100;
            const fuelCost = fuel * fuelPrice;
            const perDiemTotal = days * perDiem;
            const totalCosts = fuelCost + salary + perDiemTotal + otherCosts;
            const profit = orderCost - totalCosts;
            const margin = orderCost > 0 ? (profit / orderCost * 100) : 0;

            // Display results
            document.getElementById('resDistance').textContent = distance + ' –∫–º';
            document.getElementById('resFuel').textContent = fuel.toFixed(1) + ' –ª';
            document.getElementById('resFuelCost').textContent = fuelCost.toLocaleString('uk-UA') + ' –≥—Ä–Ω';
            document.getElementById('resSalary').textContent = salary.toLocaleString('uk-UA') + ' –≥—Ä–Ω';
            document.getElementById('resPerDiem').textContent = perDiemTotal.toLocaleString('uk-UA') + ' –≥—Ä–Ω';
            document.getElementById('resOther').textContent = otherCosts.toLocaleString('uk-UA') + ' –≥—Ä–Ω';
            document.getElementById('resIncome').textContent = orderCost.toLocaleString('uk-UA') + ' –≥—Ä–Ω';
            document.getElementById('resCosts').textContent = totalCosts.toLocaleString('uk-UA') + ' –≥—Ä–Ω';
            document.getElementById('resProfit').textContent = profit.toLocaleString('uk-UA') + ' –≥—Ä–Ω';
            document.getElementById('resMargin').textContent = margin.toFixed(1) + '%';

            // Recommendation
            const profitBox = document.getElementById('profitBox');
            const recommendation = document.getElementById('recommendation');
            
            if (profit < 0) {
                profitBox.style.background = 'linear-gradient(135deg, #f44336 0%, #d32f2f 100%)';
                recommendation.textContent = '‚ùå –ù–ï –ü–†–ò–ô–ú–ê–¢–ò! –ó–∞–º–æ–≤–ª–µ–Ω–Ω—è –∑–±–∏—Ç–∫–æ–≤–µ!';
            } else if (margin < 20) {
                profitBox.style.background = 'linear-gradient(135deg, #FFC107 0%, #FFA000 100%)';
                recommendation.textContent = '‚ö†Ô∏è –ù–∏–∑—å–∫–∞ —Ä–µ–Ω—Ç–∞–±–µ–ª—å–Ω—ñ—Å—Ç—å. –†–æ–∑–≥–ª—è–Ω—å—Ç–µ —É–≤–∞–∂–Ω–æ.';
            } else if (margin < 40) {
                profitBox.style.background = 'linear-gradient(135deg, #4CAF50 0%, #388E3C 100%)';
                recommendation.textContent = '‚úÖ –ü—Ä–∏–π–Ω—è—Ç–Ω–∞ —Ä–µ–Ω—Ç–∞–±–µ–ª—å–Ω—ñ—Å—Ç—å. –ú–æ–∂–Ω–∞ –ø—Ä–∏–π–º–∞—Ç–∏.';
            } else {
                profitBox.style.background = 'linear-gradient(135deg, #00C853 0%, #00A043 100%)';
                recommendation.textContent = 'üéâ –í–Ü–î–ú–Ü–ù–ù–û! –í–∏—Å–æ–∫–æ —Ä–µ–Ω—Ç–∞–±–µ–ª—å–Ω–µ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è!';
            }

            document.getElementById('results').style.display = 'block';
            document.getElementById('results').scrollIntoView({ behavior: 'smooth' });
        }
    </script>
</body>
</html>
